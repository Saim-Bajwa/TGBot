<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UPGRADES</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: white;
      margin: 0; padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .upgrade-section {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 20px;
      width: 320px;
      margin-bottom: 20px;
    }
    .upgrade-section > div {
      margin-bottom: 10px;
    }
    button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 10px 16px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
    }
    button.disabled {
      background-color: #444;
      cursor: not-allowed;
    }
    .tube {
      background-color: black;
      color: white;
      border: 2px solid white;
      border-radius: 15px;
      height: 60px;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 320px;
      margin: 20px auto 0 auto;
    }
    .tube div {
      display: flex;
      align-items: center;
    }
    .tube img {
      width: 24px;
      height: 24px;
      margin-right: 10px;
    }
    .tube button {
      background-color: white;
      color: black;
      border-radius: 10px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      padding: 5px 12px;
      width: auto;
    }
  </style>

  <!-- AdsGram SDK -->
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
</head>
<body>
  <h1>Upgrades</h1>

  <div class="upgrade-section">
    <div>Profit per Tap Level: <span id="profitTapLevel">Level: 1</span></div>
    <div>Profit Tap Upgrade Cost: <span id="profitTapCost">Cost: 1000</span></div>
    <button id="profitTapButton">Upgrade Profit per Tap</button>
  </div>

  <div class="upgrade-section">
    <div>Storage Level: <span id="storageLevel">Level: 1</span></div>
    <div>Storage Upgrade Cost: <span id="storageCost">Cost: 1000</span></div>
    <button id="storageButton">Upgrade Storage</button>
  </div>

  <!-- Ad reward section -->
  <div class="tube">
    <div>
      <img src="https://cdn-icons-png.flaticon.com/512/565/565547.png" alt="Ad Icon" />
      <span>Watch Ad & Earn +500 Balance</span>
    </div>
    <button id="adButton">Play Ad</button>
  </div>

  <script>
  // User data (simulate user data object)
  let user = {
    balance: 10000,
    profitPerTapLevel: 1,
    profitPerTap: 1,
    storageLevel: 1,
    maxStorage: 500,
  };

  // Cost calculation functions
  function getProfitCost(level) {
    return 1000 + (level - 1) * 2000;
  }
  function getStorageCost(level) {
    return 1000 + (level - 1) * 3000;
  }

  // UI elements
  const elements = {
    profitTapCost: document.getElementById('profitTapCost'),
    storageCost: document.getElementById('storageCost'),
    profitTapLevel: document.getElementById('profitTapLevel'),
    storageLevel: document.getElementById('storageLevel'),
    profitTapButton: document.getElementById('profitTapButton'),
    storageButton: document.getElementById('storageButton'),
    adButton: document.getElementById('adButton'),
  };

  // Update UI function
  function updateUI() {
    const profitCost = getProfitCost(user.profitPerTapLevel);
    const storageCost = getStorageCost(user.storageLevel);

    elements.profitTapCost.textContent = `Cost: ${profitCost}`;
    elements.storageCost.textContent = user.storageLevel >= 5 ? "Max" : `Cost: ${storageCost}`;
    elements.profitTapLevel.textContent = `Level: ${user.profitPerTapLevel}`;
    elements.storageLevel.textContent = user.storageLevel >= 5 ? "Max" : `Level: ${user.storageLevel}`;

    elements.profitTapButton.disabled = user.balance < profitCost;
    elements.storageButton.disabled = user.balance < storageCost || user.storageLevel >= 5;

    elements.profitTapButton.classList.toggle("disabled", user.balance < profitCost);
    elements.storageButton.classList.toggle("disabled", user.balance < storageCost || user.storageLevel >= 5);
  }

  // Simulated save function (replace with your Firebase or backend save logic)
  function save() {
    console.log("User data saved", user);
    // Example: firebase.database().ref("users/" + userId).set(user)
  }

  // AdsGram rewarded ads integration with safe environment checking
  let AdController;
  window.addEventListener('load', () => {
    if (window.Adsgram && typeof window.Adsgram.init === 'function') {
      // Replace '11592' with your actual AdsGram blockId for rewarded ads
      AdController = window.Adsgram.init({ blockId: '11592' });
    } else {
      console.warn("Adsgram SDK not loaded or Adsgram.init not available");
    }
  });

  // Function to open and show rewarded ad with safety checks
  function openRewardAd() {
    if (AdController && typeof AdController.show === 'function') {
      AdController.show().then(() => {
        // User watched the ad fully, reward balance
        user.balance += 500;
        updateUI();
        save();
        alert("+500 balance added!");
      }).catch((error) => {
        console.error("Ad error:", error);
        alert("Ad failed to play or was skipped.");
      });
    } else {
      alert("Ad system not initialized yet. Please try again in a moment.");
    }
  }

  // Optional: Telegram WebApp safe initialization (if you use Telegram SDK)
  if (window.Telegram && window.Telegram.WebApp) {
    Telegram.WebApp.ready();
  } else {
    console.log("Not inside Telegram WebApp or Telegram SDK not loaded");
  }

  // Button event listeners
  elements.profitTapButton.addEventListener("click", () => {
    const cost = getProfitCost(user.profitPerTapLevel);
    if (user.balance >= cost) {
      user.balance -= cost;
      user.profitPerTapLevel++;
      user.profitPerTap += 1;
      updateUI();
      save();
    }
  });

  elements.storageButton.addEventListener("click", () => {
    const cost = getStorageCost(user.storageLevel);
    if (user.balance >= cost && user.storageLevel < 5) {
      user.balance -= cost;
      user.storageLevel++;
      user.maxStorage += 500;
      updateUI();
      save();
    }
  });

  elements.adButton.addEventListener("click", openRewardAd);

  // Initialize UI on load
  updateUI();
</script>

</body>
</html>
