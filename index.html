<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login with Telegram</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      margin-top: 20px;
      background-color: black;
      font-family: Arial, sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid white;
      border-radius: 20px;
      padding: 10px 20px;
      margin-bottom: 30px;
      gap: 10px;
      width: 100%;
      max-width: 1000px;
    }
    .header img {
      width: 30px;
      height: 30px;
    }
    .header h1 {
      font-size: 1.2rem;
    }
    .container {
      margin-top: 30px;
      border: 2px solid white;
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      width: 100%;
      max-width: 500px;
      max-height: 300px;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #txt {
      font-size: 1.1rem;
      margin-top: 10px;
    }
    #tg-icon {
      margin-top: 25px;
      width: 60px;
      height: 60px;
    }
    @media (max-width: 480px) {
      .header h1 { font-size: 1rem; }
      .header img { width: 24px; height: 24px; }
      #txt { margin-top: 20px; font-size: 1rem; }
      #tg-icon { width: 50px; height: 50px; }
    }
    @media (min-width: 768px) {
      .header h1 { font-size: 1.5rem; }
      #txt { font-size: 1.3rem; }
      #tg-icon { width: 70px; height: 70px; }
    }
  </style>
</head>
<body>

  <header class="header">
    <img src="img.ico" alt="Logo">
    <h1>TROLL FACE TOKEN</h1>
  </header>

  <div class="container">
    <h2 id="txt">Login to Your Game Account</h2>
    <img id="tg-icon" src="tg.ico" alt="Telegram Icon">

    <!-- Telegram Login Widget -->
    <script async src="https://telegram.org/js/telegram-widget.js?7"
            data-telegram-login="troll_face_token_bot"
            data-size="large"
            data-userpic="false"
            data-request-access="write"
            data-onauth="onTelegramAuth(user)">
    </script>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-database-compat.js"></script>

  <script>
    // Firebase config (yours)
    const firebaseConfig = {
      apiKey: "AIzaSyA-c5O7UhWGSEksgsoOFXuOZgZXL7U9i9s",
      authDomain: "tg-bot-user.firebaseapp.com",
      databaseURL: "https://tg-bot-user-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "tg-bot-user",
      storageBucket: "tg-bot-user.appspot.com",
      messagingSenderId: "282564900786",
      appId: "1:282564900786:web:ff271e609718d5afd056ab",
      measurementId: "G-R45WHCZ3KZ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Auto-login if already stored
    const savedUser = JSON.parse(localStorage.getItem("tg_user"));
    if (savedUser && savedUser.id) {
      window.location.href = `home.html?uid=${savedUser.id}`;
    }

    // Telegram login handler
    function onTelegramAuth(user) {
      localStorage.setItem("tg_user", JSON.stringify(user));

      // Prevent same device multi-accounts
      const deviceKey = `device_uid`;
      if (!localStorage.getItem(deviceKey)) {
        localStorage.setItem(deviceKey, user.id);
      } else if (localStorage.getItem(deviceKey) != user.id.toString()) {
        alert("Multiple accounts on the same device are not allowed.");
        return;
      }

      // Save/update user in DB
      db.ref("users/" + user.id).set({
        id: user.id,
        username: user.username || "",
        first_name: user.first_name || "",
        last_name: user.last_name || "",
        photo_url: user.photo_url || "",
        auth_date: user.auth_date,
      });

      // Redirect
      window.location.href = `home.html?uid=${user.id}`;
    }
  </script>

</body>
</html>
