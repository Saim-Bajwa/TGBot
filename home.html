<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TROLL FACE TOKEN</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      background-color: black;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: Arial, sans-serif;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      height: 50px;
      border: 2px solid white;
      border-radius: 20px;
      margin: 20px;
      padding: 0 20px;
      gap: 10px;
      font-size: 10px;
    }

    .header img {
      height: 30px;
      width: 30px;
    }

    .container {
      margin: 20px auto;
      padding: 20px;
      border: 2px solid white;
      border-radius: 20px;
      width: 90%;
      color: white;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    #balance {
      font-size: 30px;
      font-weight: 700;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      color: white;
    }

    #balance img {
      height: 30px;
      width: 30px;
    }

    .coin-button {
      height: 200px;
      width: 200px;
      border-radius: 50%;
      background-color: #454444;
      border: 10px solid white;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
      transition: transform 0.1s, box-shadow 0.1s;
      user-select: none;
    }

    .coin-button:active {
      transform: translateY(2px);
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .coin-button img {
      height: 60px;
      width: 60px;
      background: none;
      user-select: none;
      -webkit-user-drag: none;
    }

    .coin-button.disabled {
      background-color: gray;
      cursor: not-allowed;
    }

    .tubes {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0 10px;
    }

    .tube {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: white;
      border-radius: 10px;
      padding: 5px 10px;
      color: black;
      height: 40px;
      width: 80%;
      margin: 0 auto;
      font-size: 12px;
    }

    #footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      margin: 20px;
      padding: 10px;
      background-color: black;
      border: 2px solid white;
      border-radius: 10px;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .bb {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: white;
      font-size: 0.7rem;
    }

    .bb img {
      height: 40px;
      width: 40px;
      margin-bottom: 5px;
    }

    .flying-profit,
    .flying-image {
      position: absolute;
      animation: flyUp 1s ease-out forwards;
      background: none;
      user-select: none;
      pointer-events: none;
    }

    .flying-profit {
      font-size: 16px;
      font-weight: 900;
      color: white;
    }

    @keyframes flyUp {
      from {
        opacity: 1;
        transform: translateY(-50px);
      }
      to {
        opacity: 0;
        transform: translateY(-200px);
      }
    }

    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .loadingBox {
      width: 100px;
      height: 100px;
      background-color: black;
      border: 2px solid white;
      border-radius: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .spinner {
      border: 6px solid white;
      border-top: 4px solid transparent;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <div id="loadingOverlay">
    <div class="loadingBox">
      <div class="spinner"></div>
    </div>
  </div>

  <header class="header">
    <img src="img.ico" alt="Logo">
    <h1>TROLL FACE TOKEN</h1>
  </header>

  <div id="dropdownMenu" class="dropdown-content">
    <div id="usernameDisplay" class="username">ðŸ‘¤ Loading...</div>
    <div class="logout" onclick="logout()">
      <img src="logout.ico" alt="Logout Icon">
      <span>Logout</span>
    </div>
  </div>

  <div class="container">
    <div id="balance">
      <img src="img.ico" alt="Points Icon">
      <span id="bal">0</span>
    </div>

    <button class="coin-button" id="coinButton">
      <img src="img.ico" alt="Coin">
    </button>

    <div class="tubes">
      <div class="tube" id="profit-tube">Profit per tap:</div>
      <div class="tube" id="storage-tube">Storage:</div>
    </div>
  </div>

  <div id="footer">
    <a class="bb" href="home.html"><img src="home.ico" alt="Home">Home</a>
    <a class="bb" href="upgrade.html"><img src="upgrades.ico" alt="Upgrades">Upgrades</a>
    <a class="bb" href="about.html"><img src="about.ico" alt="About">About</a>
    <a class="bb" href="fren.html"><img src="frens.ico" alt="Friends">Friends</a>
  </div>

  <!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA-c5O7UhWGSEksgsoOFXuOZgZXL7U9i9s",
    authDomain: "tg-bot-user.firebaseapp.com",
    databaseURL: "https://tg-bot-user-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "tg-bot-user",
    storageBucket: "tg-bot-user.appspot.com",
    messagingSenderId: "282564900786",
    appId: "1:282564900786:web:ff271e609718d5afd056ab",
    measurementId: "G-R45WHCZ3KZ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  const balanceDisplay = document.getElementById("bal");
  const storageTube = document.getElementById("storage-tube");
  const coinButton = document.getElementById("coinButton");
  const container = document.querySelector(".container");
  const profitTube = document.getElementById("profit-tube");
  const loadingOverlay = document.getElementById("loadingOverlay");
  const menuButton = document.querySelector(".dropbtn");
  const dropdown = document.getElementById("dropdownMenu");
  const usernameDisplay = document.getElementById("usernameDisplay");

  let balance = 0;
  let profitPerTap = 1;
  let storage = 3000;
  let maxStorage = 3000;
  let userId = null;

  menuButton.addEventListener("click", () => {
    dropdown.classList.toggle("show");
  });

  document.addEventListener("click", (event) => {
    if (!event.target.closest(".dropdown") && !event.target.closest("#dropdownMenu")) {
      dropdown.classList.remove("show");
    }
  });

  function updateUI() {
    balanceDisplay.textContent = balance;
    storageTube.textContent = `Storage: ${storage}/${maxStorage}`;
    profitTube.textContent = `Profit per tap: ${profitPerTap}`;
  }

  function toggleCoinButton() {
    const disabled = storage <= 0;
    coinButton.disabled = disabled;
    coinButton.classList.toggle("disabled", disabled);
  }

  function createFlyingElement(text, x, y) {
    const element = document.createElement("div");
    element.textContent = text;
    element.className = "flying-profit";
    element.style.left = `${x}px`;
    element.style.top = `${y}px`;
    container.appendChild(element);
    setTimeout(() => container.removeChild(element), 1000);
  }

  function createFlyingImage(x, y) {
    const img = document.createElement("img");
    img.src = "img.ico";
    img.className = "flying-image";
    img.style.left = `${x}px`;
    img.style.top = `${y}px`;
    img.style.height = "20px";
    img.style.width = "20px";
    container.appendChild(img);
    setTimeout(() => container.removeChild(img), 1000);
  }

  window.logout = function () {
    localStorage.clear();
    signOut(auth)
      .then(() => {
        window.location.href = "index.html";
      })
      .catch((error) => {
        console.error("Logout error:", error);
        alert("Failed to logout.");
      });
  };

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    userId = user.uid;
    const userRef = ref(db, `users/${userId}`);
    const balanceRef = ref(db, `users/${userId}/balance`);
    const profitRef = ref(db, `users/${userId}/profitPerTap`);
    const storageRef = ref(db, `users/${userId}/storage`);
    const maxStorageRef = ref(db, `users/${userId}/maxStorage`);
    const usernameRef = ref(db, `users/${userId}/username`);

    try {
      const [balSnap, profitSnap, storageSnap, maxSnap, nameSnap] = await Promise.all([
        get(balanceRef),
        get(profitRef),
        get(storageRef),
        get(maxStorageRef),
        get(usernameRef),
      ]);

      balance = balSnap.exists() ? balSnap.val() : 0;
      profitPerTap = profitSnap.exists() ? profitSnap.val() : 1;
      storage = storageSnap.exists() ? storageSnap.val() : 0;
      maxStorage = maxSnap.exists() ? maxSnap.val() : 100;
      usernameDisplay.innerText = nameSnap.exists() ? `ðŸ‘¤ ${nameSnap.val()}` : "ðŸ‘¤ Unknown User";

      updateUI();
      toggleCoinButton();
      loadingOverlay.style.display = "none";

      setInterval(() => {
        if (storage < maxStorage) {
          storage = Math.min(storage + profitPerTap, maxStorage);
          set(storageRef, storage);
          updateUI();
          toggleCoinButton();
        }
      }, 1000);

      coinButton.addEventListener("click", (e) => {
        if (storage >= profitPerTap) {
          balance += profitPerTap;
          storage -= profitPerTap;

          updateUI();
          toggleCoinButton();

          update(userRef, { balance, storage }).catch(console.error);

          const rect = coinButton.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          createFlyingElement(`+${profitPerTap}`, x + rect.left - 68, y + rect.top);
          createFlyingImage(x + rect.left - 30, y + rect.top + 2);
        }
      });
    } catch (err) {
      console.error("Error loading user data:", err);
      alert("Failed to load user data.");
    }
  });
</script>




</body>
</html>
